<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fire Hydrants Over Time</title>
    <style>
        #chart {
            width: 100%;
            height: 350px;
        }
    </style>
    <!-- Resources -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>
<body>
    <h2>Number of Fire Hydrants Over 10-Year Intervals</h2>
    <div id="chart"></div>

    <script>
        async function fetchFireHydrantData() {
            const sqlQuery = `SELECT * FROM "1479a183-dde0-46a6-a828-f526df010a03"`;
            const url = `https://data.boston.gov/api/3/action/datastore_search_sql?sql=${encodeURIComponent(sqlQuery)}`;
            const response = await axios.get(url);
            return response.data.result.records;
        }

        function processHydrantData(records) {
            const intervalCounts = {};
            records.forEach(record => {
                const year = parseInt(record.MANUFACTUR);
                if (!isNaN(year) && year > 0) {
                    const interval = Math.floor(year / 10) * 10;
                    if (!intervalCounts[interval]) {
                        intervalCounts[interval] = 0;
                    }
                    intervalCounts[interval]++;
                }
            });
            return Object.entries(intervalCounts).sort((a, b) => a[0] - b[0]);
        }

        async function renderChart() {
            const records = await fetchFireHydrantData();
            const intervalData = processHydrantData(records);
            const years = intervalData.map(item => item[0]);
            const counts = intervalData.map(item => item[1]);

            var options = {
                series: [{
                    name: "Fire Hydrants",
                    data: counts
                }],
                chart: {
                    height: 350,
                    type: 'line',
                    zoom: {
                        enabled: false
                    }
                },
                dataLabels: {
                    enabled: false
                },
                stroke: {
                    curve: 'straight'
                },
                title: {
                    text: 'Number of Fire Hydrants Over 10-Year Intervals',
                    align: 'left'
                },
                grid: {
                    row: {
                        colors: ['#f3f3f3', 'transparent'], // takes an array which will be repeated on columns
                        opacity: 0.5
                    },
                },
                xaxis: {
                    categories: years,
                    title: {
                        text: 'Year'
                    }
                },
                yaxis: {
                    title: {
                        text: 'Number of Fire Hydrants'
                    }
                }
            };

            var chart = new ApexCharts(document.querySelector("#chart"), options);
            chart.render();
        }

        renderChart();
    </script>
</body>
</html>
